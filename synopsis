pipeline{
 agent {
 label '!polaris'
 }
 environment {
 BRIDGE_POLARIS_APPLICATION_NAME = 'Logistics'
 BRIDGE_POLARIS_PROJECT_NAME = 'ml-cv-portal'
 }
 stages {
 stage('Checkout') {
 steps {
 git branch: BRANCH_NAME, credentialsId: 'payyardevar', url: 'https://github.com/MatsonInc/ml-cv-portal/'
 }
 }
 stage('polaris') {
 steps {
 withCredentials([string(credentialsId: 'POLARIS_ACCESSTOKEN', variable:'BRIDGE_POLARIS_ACCESSTOKEN')]) {
 script {
 status = sh returnStatus: true, script: """
 curl -fLsS -o bridge.zip $BRIDGECLI_LINUX64 && unzip -qo -d /tmp bridge.zip && rm -f bridge.zip 
 /tmp/synopsys-bridge --verbose --stage polaris polaris.assessment.types=SAST,SCA
 """
 if (status == 8) { unstable 'policy violation' }
 else if (status != 0) { error 'bridge failure' }
 }
 }
 }
 }
 }
 }
 
